# ExcelTaskAggregationTool
## 作業時間集計マクロ セットアップ手順

本手順は、Excelで `data` シートの A4 以降に記録した「`hhmm-hhmm タスク名`」を集計し、`result` シートに出力する環境を構築します。マクロはボタン操作で実行します。

---

### 1. dataシート作成

1. ブックを開く。
2. シート名を `data` にする。
3. A4 以降の A 列に以下の形式で入力する。  
   例:  
   ```
   0900-1030 作業A
   1045-1200 打合せ
   1300-1445 作業A
   ```
   - 固定フォーマット: **4桁時刻-4桁時刻 + 半角スペース + タスク名**
   - 先頭3行は自由。集計対象は **A4 以降**。

---

### 2. ボタン作成（dataシート）

どちらの種類でも可。ここでは **フォームコントロールのボタン** を例示。

1. [開発] タブ → [挿入] → [フォームコントロール] → [ボタン] を選択。
2. data シート上に **ボタン1** を配置し、後でマクロ `ボタン1_Click` を割り当てる。
3. 同様に **ボタン2** を配置し、後でマクロ `ボタン2_Click` を割り当てる。

> ActiveX コントロールを使う場合は、配置後に [デザインモード] をオンにしてプロパティを調整し、クリックイベントで同名のマクロを呼び出してください。

---

### 3. Module1 にコード作成

1. `Alt + F11` でVBAエディタを開く。
2. [挿入] → [標準モジュール] をクリック（`Module1` が作成される）。
3. Module1.vbaの **フルコード** をそのまま貼り付けて保存。

---

### 4. ボタンにマクロを割り当て

- **ボタン1** → `ボタン1_Click`
- **ボタン2** → `ボタン2_Click`

> フォームコントロールのボタンなら、右クリック → [マクロの登録] で選択。

---

### 5. 実行

- data シートで **ボタン1** を押す → `result` シートが最後尾に作成され、集計結果が表示される。
- data シートで **ボタン2** を押す → `A4` 以降の入力が消える。

---

### 6. 注意・ヒント

- マクロを有効にするには拡張子を **.xlsm** にする。
- 文字フォーマットは **`hhmm-hhmm タスク名`** に厳密に従うこと。
- タスク名は任意の文字列で可。A列以外は参照しない。
- 並び替えは合計時間（分）の降順。

---

### 7. トラブルシュート

- `result` にヘッダのみ → A4以降の文字列が書式に合っていない。
- 「With ブロック変数が設定されていません」 → 旧版の `Worksheet.Sort` を使っている可能性。上記コードは `Range.Sort` を使用済み。
- 「変数が定義されていません」 → 環境定数未定義が原因。上記では数値で指定済み（Order1:=2 など）。
